% !TEX root = main.tex
\section{Proofs}\label{sec:proofs}

\subsection{Proof of Theorem 1}\label{proofs:IEM}
\subsubsection{Proof of (i)}
First, let us define for $\theta \in \Theta$
\begin{equation}\label{sumsurrogate}
 \bar{A}^k(\theta) \triangleq \sum_{i=1}^{N}{A^k_i(\theta)}\eqs,
\end{equation}
where for all $i \in \inter$, $A^{k}_{i}$ is defined in \eqref{Ai}. For any $k \geq 1$ and for all $\theta \in \Theta$ the following decomposition plays a key role:
\begin{equation}\label{deterquantity}
\bar{A}^k(\theta) = \bar{A}^{k-1}(\theta) + \sum_{i \in I_{k}}^{}{B_{i,\theta^{k-1}}(\theta)} - \sum_{i \in I_{k}}^{}{A^{k-1}_{i}(\theta)}.
\end{equation}
Since by construction $\bar{A}^k(\theta^k) \leq  \bar{A}^k(\theta^{k-1})$, we get:
\begin{align}\label{eq:decreasing}
\bar{A}^k(\theta^k) \leq \bar{A}^{k-1}(\theta^{k-1}) + \sum_{i \in I_{k}}^{}{B_{i,\theta^{k-1}}(\theta^{k-1})} - \sum_{i \in I_{k}}^{}{A^{k-1}_{i}(\theta^{k-1})}.
\end{align}
Since for $i \in I_k$, $B_{i,\theta^{k-1}}$ is a surrogate of $\loglike_i$ at $\theta^{k-1}$ we get that  $B_{i,\theta^{k-1}}(\theta^{k-1}) = \loglike_{i}(\theta^{k-1})$. On the other hand, for $i \in \inter$, $A^{k-1}_{i} \equiv B_{i,\theta^{\tau_{i,k-1}}}$ and $B_{i,\theta^{\tau_{i,k-1}}}$ is a surrogate of $\loglike_i$ at $\theta^{\tau_{i,k-1}}$, thus we obtain that $ \loglike_{i}(\theta^{k-1}) - A^{k-1}_{i}(\theta^{k-1}) \leq 0$. Plugging these two relations in \eqref{eq:decreasing}  we obtain:
\begin{align}
\bar{A}^k(\theta^k) & \leq \bar{A}^{k-1}(\theta^{k-1}) + \sum_{i \in I_{k}}^{}{\loglike_{i}(\theta^{k-1})} - \sum_{i \in I_{k}}^{}{A^{k-1}_{i}(\theta^{k-1})}\\
& \leq \bar{A}^{k-1}(\theta^{k-1})\eqs.
\end{align}
As a result, the sequence $\left(\bar{A}^k(\theta^k)\right)_{k\geq0}$ is monotonically decreasing.  Since, under assumption \cref{bounded}, this quantity is bounded from below with probability one, we obtain its almost sure convergence. Taking the expectations with respect to the sampling distributions of the previous inequalities implies the convergence of the (deterministic) sequence $\left(\E[\bar{A}^k(\theta^k)]\right)_{k\geq0}$. Let us denote for all $\theta \in \Theta$ and a subset $J \subset \inter$:
\begin{align}\label{batchnotation}
& \loglike_{J}(\theta) \triangleq \sum_{i \in J}^{}{\loglike_{i}(\theta)}\eqs,\\
& A^{k-1}_{J}(\theta) \triangleq \sum_{i \in J}^{}{A^{k-1}_{i}(\theta)}\eqs.
\end{align}
Inequality \eqref{eq:decreasing} gives :
\begin{align}
0 \leq \sum_{k=1}^{N}{A^{k-1}_{I_{k}}(\theta^{k-1}) - \loglike_{I_{k}}(\theta^{k-1})} \leq \sum_{k=1}^{N}{ \bar{A}^{k-1}(\theta^{k-1}) - \bar{A}^k(\theta^{k})} =  \bar{A}^{0}(\theta^{0}) - \bar{A}^n(\theta^{N})\eqs.
\end{align}
Consequently, the sum of positive terms $\left(\sum_{k=1}^{N}{A^{k-1}_{I_{k}}(\theta^{k-1}) - \loglike_{I_{k}}(\theta^{k-1})} \right)_{n \geq 1}$ converges almost surely and $\left(A^{k-1}_{I_{k}}(\theta^{k-1}) - \loglike_{I_{k}}(\theta^{k-1})\right)_{k\geq1}$ converges almost surely to zero.
The Beppo-Levi theorem and the Tower property of the conditional expectation imply:
\begin{align}\label{Mdeter1}
\mathsf{M} \triangleq \E \left[\sum_{k=0}^{\infty}{A^{k-1}_{I_{k}}(\theta^{k-1}) - \loglike_{I_{k}}(\theta^{k-1})}\right] & = \sum_{k=0}^{\infty}{\E \left[A^{k-1}_{I_{k}}(\theta^{k-1}) - \loglike_{I_{k}}(\theta^{k-1})\right]} \\
& = \sum_{k=0}^{\infty}{\E \left[\CPE{A^{k-1}_{I_{k}}(\theta^{k-1}) - \loglike_{I_{k}}(\theta^{k-1})}{\mathcal{F}_{k-1}} \right]}\eqs,
\end{align}
with 
\begin{align*}
& \CPE{\loglike_{I_{k}}(\theta^{k-1})}{\mathcal{F}_{k-1}} = \frac{p}{N} \loglike(\theta^{k-1}) \eqs,\\
& \CPE{[A^{k-1}_{I_{k}}(\theta^{k-1})}{\mathcal{F}_{k-1}} = \frac{p}{N} \sum_{i=1}^{N}{A^{k-1}_{i}(\theta^{k-1})} = \frac{p}{N}\bar{A}^{k-1}(\theta^{k-1}) \eqs,
\end{align*}
where $\mathcal{F}_{k-1} = \sigma(I_j, j \leq k-1)$ is the filtration generated by the sampling of the indices.
We thus obtain:
\begin{align}\label{Mdeter2}
\mathsf{M} =\frac{p}{N} \sum_{k=0}^{\infty}{\E \left[\bar{A}^{k-1}(\theta^{k-1}) - \loglike(\theta^{k-1})\right]} = \frac{p}{N} \E \left[\sum_{k=0}^{\infty}{\bar{A}^{k-1}(\theta^{k-1}) - \loglike(\theta^{k-1})}\right] < \infty \eqs.
\end{align}
This last equation shows that:
\begin{equation}\label{detergap}
    \lim \limits_{k \to \infty} \bar{A}^{k}(\theta^{k}) - \loglike(\theta^{k}) = 0 \quad \textrm{a.s.}
\end{equation}
which implies the almost sure convergence of $\left(\loglike(\theta^{k})\right)_{k\geq0}$.

\subsubsection{Proof of (ii)}
Let us define, for all $k \geq 0$, $\bar{h}_k$ as:
\begin{equation}\label{smoothH}
\bar{h}^k : \vartheta \to \sum_{i=1}^N{A^k_{i}(\vartheta) - \loglike_i(\vartheta)}\eqs.
\end{equation}
$\bar{h}^k$ is $L$-smooth with $L = \sum_{i=1}^N{L_i}$ since each of its component is $L_i$-smooth by definition of the surrogate functions. Using the particular parameter $\vartheta^k = \theta^k - \frac{1}{L}\nabla\bar{h}_k(\theta^k) $ we have the following classical inequality for smooth functions (cf. Lemma 1.2.3 in \citep{nesterov2007Gradient}):
\begin{align}\label{nest}
& 0 \leq \bar{h}^k(\vartheta^k) \leq \bar{h}^k(\theta^k) - \frac{1}{2L}\|\nabla\bar{h}^k(\theta^k)\|_2^2\\
\implies &  \|\nabla\bar{h}^k(\theta^k)\|_2^2 \leq 2L\bar{h}^k(\theta^k)\eqs.
\end{align}
Using \eqref{detergap}, we conclude that $\lim \limits_{k \to \infty}\|\nabla\bar{h}^k(\theta^k)\|_2 = 0$ a.s. Then, the decomposition of $\langle \nabla \loglike(\theta^k),\theta - \theta^k \rangle$ for any $\theta \in \Theta$ yields:

\begin{equation}
\langle \nabla \loglike(\theta^k),\theta - \theta^k \rangle = \langle \nabla \bar{A}^k(\theta^k), \theta - \theta^k \rangle - \langle \nabla\bar{h}^k(\theta^k),\theta - \theta^k \rangle\eqs.
\end{equation}
Note that $\theta^k$ is the result of the minimisation of the sum of surrogates $\bar{A}^k(\theta)$ on the constrained set $\Theta$, therefore  $\langle \nabla \bar{A}^k(\theta^k), \theta - \theta^k \rangle \geq 0$. Thus, we obtain, using the Cauchy-Schwarz inequality:
\begin{align}
\langle \nabla \loglike(\theta^k),\theta - \theta^k \rangle & \geq - \langle \nabla\bar{h}^k(\theta^k),\theta - \theta^k \rangle\\
& \geq - \|\nabla\bar{h}^k(\theta^k)\|_2 \|\theta - \theta^k\|_2 \eqs.
\end{align}
By minimising over $\Theta$ and taking the infimum limit on $k$, we get:
\begin{equation}
\liminf \limits_{k \to \infty}\inf \limits_{\theta \in \Theta} \frac{\langle \nabla \loglike(\theta^k),\theta - \theta^k \rangle}{\|\theta - \theta^k\|_2} \geq - \lim \limits_{k \to \infty}\|\nabla\bar{h}^k(\theta^k)\|_2 = 0 \eqs,
\end{equation}
which is the Asymptotic Stationary Point Condition  (ASPC).
